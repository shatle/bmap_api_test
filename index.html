<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript" src="./jquery-1.9.1.min.js"></script>
	<style type="text/css">
	body, html, .fw-content{width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
	.fw-content > div {
		position: fixed;
		top: 0;
		bottom: 0;
		height: 100%;
	}
	.fw-content #tips {
		top: 0;
    left: 0;
    z-index: 2;
    width: 60%;
    background: #FFF;
    height: 30px;
	}
	.fw-content .fw-main {
		width: 70%;
		left: 0;
	}
	.fw-content .fw-rightside {
		width: 30%;
		right: 0;
	}
	.fw-content .fw-rightside .fw-rightside-box > div {
		padding: 14px;
		width: 100%;
	}
	#commands {
		height: 70px;
		border-bottom: 2px solid #DDD;
	}
	#result {
		overflow: auto;
	}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=XNTuIUSmOsyVxNHatYQvweYhelAt2RGz"></script>
	<title>地图展示</title>
</head>
<body>
	<div class="fw-content">
		<div id="tips">得到的经纬度是百度数据，不是真正的gps数据(转换算法百度是不会公开的)</div>
		<div id="allmap" class="fw-main"></div>
		<div class="fw-rightside">
			<div class="fw-rightside-box">
				<div id="commands">
					<div class="line">
						<label for="">城市: </label>
						<input id="inputCityName" style="width: 100px;" type="text" placeholder="城市" />
						<button id="btnCityName" class="reload-city">调整城市</button>
					</div>
					<div class="line">
						<label for="">精度(小则地图范围大): </label>
						<input id="inputAreaNum" style="width: 50px;" type="text" placeholder="精度" />
						<button id="btnAreaNum" class="reload-city">确定</button>
					</div>
					<div class="line">
						<input type="text" id="inputSearchWord">
						<button id="btnSearchWord">查询</button>
					</div>
				</div>
				<div id="result"></div>
			</div>
		</div>
	</div>
	
</body>
</html>
<script type="text/javascript">
	// set height
	jQuery(document).ready(function($) {
		// 
		function setResultHeight(){
			var h = $(window).height()-100-15*2;
			if (h< 50) { h = 50 }
			$('#result').height(h);
		}
		setResultHeight();
		$(window).resize(function(event) {
			setResultHeight();
		});

		// 百度地图API功能
		var map = new BMap.Map("allmap");
		var point = new BMap.Point(113.301459, 23.092816);
		map.centerAndZoom(point,11);
		// map.addControl(new BMap.NavigationControl());
		map.enableScrollWheelZoom();
		map.enableContinuousZoom();

		function myFun(result){
			var cityName = result.name;
			map.setCenter(cityName);
			$('input#inputCityName').val(cityName);
			$('input#inputAreaNum').val(11)
		}
		var myCity = new BMap.LocalCity();
		myCity.get(myFun);
		// 

		// 
		function theLocation(){
			var city = document.getElementById("inputCityName").value;
			var num = document.getElementById("inputAreaNum").value;
			if(city != ""){
				num = $.trim(num)=="" ? 11 : parseInt(num);
				map.centerAndZoom(city,num);      // 用城市名设置地图中心点
				$('input#inputAreaNum').val(num);
			}
		}
		$('button#btnCityName').click(theLocation);
		$('input#inputCityName').keydown(function(event) {
			if (event.keyCode == 13){
				theLocation();
			}
		});
		$('button#btnAreaNum').click(theLocation);
		$('input#inputAreaNum').keydown(function(event) {
			if (event.keyCode == 13){
				theLocation();
			}
		});
		// 
		
		// 百度地图API功能
		function searchWord(word){
			var options = {
				onSearchComplete: function(results){
					// 判断状态是否正确
					if (local.getStatus() == BMAP_STATUS_SUCCESS){
						var s = [];
						for (var i = 0; i < results.getCurrentNumPois(); i ++){
							var poi = results.getPoi(i);
							s.push(poi.title + ", " + poi.address+ ", "+ poi.point.lng + ", "+ poi.point.lat );
						}
						document.getElementById("result").innerHTML = s.join("<br/><br/>");
					}
				},
				renderOptions: {map: map}
			};
			var local = new BMap.LocalSearch(map, options);
			local.search(word);
		}
		$('#btnSearchWord').click(function(){
			searchWord($('#inputSearchWord').val());
		});
		$('#inputSearchWord').keydown(function(event) {
			if (event.keyCode == 13){
				searchWord($('#inputSearchWord').val());
			}
		});
		
		// 
	});
	
</script>
